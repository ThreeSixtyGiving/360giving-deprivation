{"version":3,"sources":["logo.svg","DataHandling.js","Utils.js","components/FiltersComponent/FiltersComponent.js","VizHelpers.js","components/DeprivationScatterPlot/DeprivationScatterPlot.js","components/DonorBarChart/DonorBarChart.js","components/MapComponent/MapComponent.js","components/BodyComponent/BodyComponent.js","components/TempBodyComponent/TempBodyComponent.js","App.js","DataLoading.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","prepAllData","originalData","selectedRegion","selectedGeoLevel","selectedComparison","filters","console","log","grant","comparison","geo","dataForMap","dataForScatter","dataForSmallMultiples","comparisonVars","untouchedVars","Object","objectWithoutProperties","allComparisonTypes","keys","data","forEach","d","filterOn","filterLocation","_filterDiscrete","filterDiscrete","grantFiltered","comparisonFiltered","map","c","columns","filter","startsWith","value","label","s","slice","split","join","word","toUpperCase","_","flatten","sourceName","prepScatterData","prepSmallMultiplesData","objectSpread","scatterRight","nest","key","id","rollup","values","defineProperty","some","x","dataField","sum","entries","scatterLeft","mergeById","placeName","lookUp","leaves","projects","total_awarded","y","length","filterKeys","grantData","comparisonData","includes","grantLocationKey","yearsRange","range","extent","mainTable","lookupTable","mainKey","lookupKey","keepVarsMain","keepVarsLookup","select","mainItem","lookUpItem","mainKeep","mainValueLocation","lookUpValueLocation","lookUpKeep","pick","l","m","lookupIndex","output","i","row","j","push","FiltersComponent","props","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","react_default","a","createElement","className","Component","defaultProps","getColorScale","scaleQuantile","domain","convertHex","hex","opacity","replace","parseInt","substring","makeTooltip","title","items","htmlBlock","DeprivationScatterPlot","_this","createBarChart","bind","assertThisInitialized","_this2","filterFunc","addFilter","remove","tooltip","tip","attr","offset","direction","html","xValLabel","format","xVal","_ref","margin","width","dimensions","height","node","xValues","yValues","_extent","_extent2","slicedToArray","yMin","yMax","scaleLinear","scaleLog","colorScale","selectAll","g","append","enter","on","show","hide","location","axisBottom","ticks","tickFormat","axisLeft","_this3","onClick","ref","DonorBarChart","year","amount","dataForChart","scaleBand","padding","max","bandwidth","mapboxgl","accessToken","MapComponent","setStateForMe","state","setState","markerHeight","markerRadius","linearOffset","popupOffsets","top","top-left","top-right","bottom","bottom-left","bottom-right","left","right","popup","Popup","closeButton","mainLayerId","_this$state","mainSourceId","Map","container","mapContainer","style","center","mapFormatting","position","zoom","_this2$props","mapData","scatterPlotData","mapGeoId","mapGeoPlaceName","allMapSources","expression","buildDataLayer","addSource","filePath","addDataLayer","setUpMouseOver","hoveredStateId","myMap","e","features","setFeatureState","source","hover","lngLat","setLngLat","setHTML","properties","addTo","color","type","generateId","addLayer","paint","fill-color","fill-outline-color","line-color","line-width","removeLayer","nextProps","waiting","isStyleLoaded","getLayer","removeDataLayer","setTimeout","_this4","el","YearSlider","createSliderWithTooltip","Slider","Range","BodyComponent","lib","fluid","xs","allowCross","defaultValue","min","onAfterChange","years","dots","pushable","components_MapComponent_MapComponent","scatterPlotXVal","scatterPlotXValLabel","components_DeprivationScatterPlot_DeprivationScatterPlot","smallMultiplesData","components_DonorBarChart_DonorBarChart","options","name","description","property","stops","React","App","mutatedData","layerControls","toggle","newFilterObj","k","consolidatedFilters","concat","getData","files","LAD","ward","abbreviations","geoLevel","region","eng","sco","nir","wal","uk","regions","geoLevels","promises","f","csv","json","Promise","all","then","result","_loop","_files$i$name$split","_files$i$name$split2","toArray","category","country","otherParts","datasetName","toConsumableArray","keyBy","valueRegion","keyRegion","valueLevel","keyLevel","loadAllData","getComparisonVarLabel","isLoading","isEmpty","regionPicker","react_select_esm","onChange","selectedOption","geoPicker","comparisonPicker","components_BodyComponent_BodyComponent","Boolean","window","hostname","match","ReactDOM","render","src_App_0","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.9976e19d.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.5d5d9eef.svg\";","import { nest } from 'd3-collection';\nimport { sum } from 'd3-array';\nimport { extent } from 'd3-array'\nimport _ from 'lodash';\nimport { capitalize } from './Utils';\n\nconst grants_defult_dataset_name = 'LAD_ward_donor_year';\n\nexport const prepAllData = (originalData, selectedRegion, \n  selectedGeoLevel, selectedComparison, filters) => {\n\n  console.log(originalData);\n  console.log(selectedRegion, selectedGeoLevel, selectedComparison);\n\n  let {grant, comparison, geo, \n    dataForMap, dataForScatter, dataForSmallMultiples, \n    comparisonVars,\n    ...untouchedVars} = originalData;\n\n  console.log(untouchedVars);\n  const allComparisonTypes = Object.keys(comparison[selectedRegion][selectedGeoLevel]);\n\n  // test\n  // filters = {'location': ['E09000028','E09000001'], 'years': [2013,2016]};\n\n  console.log(\"filters: \",filters);\n  grant[selectedRegion][grants_defult_dataset_name].data.forEach(d => {\n    // d.filterOn = Math.random() > 0.5 ? true : false;\n    d.filterOn = true;\n    d.filterLocation = true;\n  })\n  comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].data.forEach(d => {\n    // d.filterOn = Math.random() > 0.5 ? true : false;\n    d.filterOn = true;\n    d.filterLocation = true;\n  })\n\n  // filter functions \n  if (filters) {\n    // {grantFiltered: grantData, comparisonFiltered: comparisonData}\n    let {grantFiltered, comparisonFiltered} = filterDiscrete(\n      filters,\n      grant[selectedRegion][grants_defult_dataset_name],\n      comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]],\n      selectedRegion, \n      selectedGeoLevel, \n      selectedComparison\n    )\n\n    grant[selectedRegion][grants_defult_dataset_name].data = grantFiltered;\n    comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].data = comparisonFiltered;\n  }\n\n  console.log(grant);\n\n  comparisonVars = allComparisonTypes\n    .map(c => {\n      console.log(comparison[selectedRegion][selectedGeoLevel][c]);\n      return comparison[selectedRegion][selectedGeoLevel][c].data.columns\n        .filter(d => d.startsWith(\"comparison_\"))\n        .map(d => {\n          return {\n            value: [c, d], \n            label: capitalize((c + ' - ' + d.slice(11)).split('_').join(' '))}\n        });\n    })\n\n  comparisonVars = _.flatten(comparisonVars);\n  \n  // [selectedComparison[0]]\n\n  // prep filtered data for charts\n  dataForMap = geo[selectedRegion][selectedGeoLevel].sourceName;\n  dataForScatter = prepScatterData(originalData, selectedRegion, \n    selectedGeoLevel, selectedComparison);\n  dataForSmallMultiples = prepSmallMultiplesData(originalData, selectedRegion);\n\n  \n\n  // return object with data prepared for each chart\n  return {\n    grant, comparison, geo, \n    comparisonVars: comparisonVars,\n    dataForMap: dataForMap, \n    dataForScatter: dataForScatter, \n    dataForSmallMultiples: dataForSmallMultiples,\n    ...untouchedVars\n  }\n}\n\nexport const prepScatterData = (originalData, selectedRegion, \n  selectedGeoLevel, selectedComparison) => {\n\n  console.log(originalData);\n\n  // right hand side dataset (Y-Axis)\n  const scatterRight = nest()\n    .key(d => d[originalData.grant[selectedRegion][grants_defult_dataset_name].id[selectedGeoLevel]])\n    .rollup(values => \n      ({\n        filterOn: values.some(x => x.filterOn === true) === true,\n        filterLocation: values.some(x => x.filterLocation === true) === true,\n        [originalData.grant[selectedRegion][grants_defult_dataset_name].dataField]: sum(values, d => {\n          let returnVal = d.filterOn \n            ? +d[originalData.grant[selectedRegion][grants_defult_dataset_name].dataField]\n            : 0;\n          // return d.filterOn \n          //   ? +d[originalData.grant[selectedRegion][grants_defult_dataset_name].dataField]\n          //   : 0;\n          return returnVal;\n        }) \n      })\n    )\n    .entries(originalData.grant[selectedRegion][grants_defult_dataset_name].data);\n\n  console.log(scatterRight);\n\n  // left hand side dataset (X-Axis) \n  const scatterLeft = nest()\n    .key(d => d[originalData.comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].id])\n    .entries(originalData.comparison[selectedRegion][selectedGeoLevel][selectedComparison[0]].data);\n\n  // merge left hand side dataset and right hand side dataset\n  const mergedLeftRight = mergeById(scatterLeft,scatterRight,'key','key',\n    [selectedComparison[1]],\n    [originalData.grant[selectedRegion][grants_defult_dataset_name].dataField]\n  );\n\n  // Get place names\n  return mergedLeftRight.map(d => {\n    const placeName = originalData.geo[selectedRegion][selectedGeoLevel].lookUp[d.id]\n      ? originalData.geo[selectedRegion][selectedGeoLevel].lookUp[d.id].value\n      : '';\n    return {...d, placeName: placeName};\n  });\n}\n\nexport const prepSmallMultiplesData = (originalData, selectedRegion) => {\n  \n  const data = originalData.grant[selectedRegion][grants_defult_dataset_name].data;\n\n  var nested_data = nest()\n  .key(function(d) { return d['Funding Org:Name']; })\n  .key(function(d) { return d['Award Year']; })\n  .rollup(function(leaves) { \n    return {\n      \"projects\": sum(leaves, d => (d['filterOn'] && d['filterLocation']) ? d['Identifier'] : 0), \n      \"total_awarded\": sum(leaves, d => (d['filterOn'] && d['filterLocation']) ? d['Amount Awarded'] : 0)\n    } \n  })\n  .entries(data);\n\n  // console.log(nested_data);\n  return nested_data.filter(d => d.values.filter(y => y.value[\"total_awarded\"]>0).length > 0);\n}\n\n// Filterable dimensions:\n// - location\n// - time\nexport const filterDiscrete = (filters,grant,comparison,\n  selectedRegion,selectedGeoLevel,selectedComparison) => {\n  const filterKeys = Object.keys(filters);\n\n\n  let grantData = grant.data;\n  let comparisonData = comparison.data;\n\n  console.log(filterKeys,filters,grantData,comparisonData);\n  console.log(\"location\" in filterKeys);\n\n  if (filterKeys.includes('location') && filters['location'] !== 'reset') {\n    const grantLocationKey = grant.id[selectedGeoLevel];\n    grantData.forEach(d => {\n      d.filterLocation = (filters['location'].includes(d[grantLocationKey])) ? true : false;\n    })\n  }\n\n  if (filterKeys.includes('years') && filters['years'] !== 'reset') {\n    const yearsRange = _.range(extent(filters['years'])[0],extent(filters['years'])[1]);\n    // console.log(extent(filters['years']));\n    grantData.forEach(d => {\n      d.filterOn = (yearsRange.includes(+d['Award Year'])) ? true : false;\n    })\n  }\n\n  return {grantFiltered: grantData, comparisonFiltered: comparisonData}\n}\n\nexport const filterContinuous = () => {\n\n}\n\nexport const mergeById = (mainTable, lookupTable, \n  mainKey, lookupKey, keepVarsMain, keepVarsLookup) => {\n\n  const select = (mainItem, lookUpItem) => {\n\n    let mainKeep, mainValueLocation, lookUpValueLocation, lookUpKeep, filterOn, filterLocation;\n    mainKeep = mainValueLocation = lookUpValueLocation = lookUpKeep = filterOn = filterLocation = null;\n    \n    if(mainItem) {\n      mainValueLocation = mainItem.value ? mainItem.value : mainItem.values[0];\n      mainKeep = _.pick(mainValueLocation, keepVarsMain);\n    }\n\n    if(lookUpItem) {\n      lookUpValueLocation = lookUpItem.value ? lookUpItem.value : lookUpItem.values[0];\n      lookUpKeep = _.pick(lookUpValueLocation, keepVarsLookup);\n    }\n\n    if (mainItem && lookUpItem) {\n      filterOn = mainValueLocation.filterOn && lookUpValueLocation.filterOn;\n      filterLocation = mainValueLocation.filterLocation && lookUpValueLocation.filterLocation;\n    }\n    else if (mainItem) {\n      filterOn = mainValueLocation.filterOn;\n      filterLocation = mainValueLocation.filterLocation;\n    }\n    else if (lookUpItem) {\n      filterOn = lookUpValueLocation.filterOn;\n      filterLocation = lookUpValueLocation.filterLocation;\n    }\n\n    return {\n      id: mainItem.key,\n      ...mainKeep,\n      ...lookUpKeep,\n      filterOn: filterOn,\n      filterLocation: filterLocation\n    };\n  }\n\n  console.log(mainTable,lookupTable);\n\n  let l = lookupTable.length,\n      m = mainTable.length,\n      lookupIndex = [],\n      output = [];\n      \n  for (let i = 0; i < l; i++) { // loop through l items\n    let row = lookupTable[i];\n    lookupIndex[row[lookupKey]] = row; // create an index for lookup table\n  }\n  for (let j = 0; j < m; j++) { // loop through m items\n    let y = mainTable[j];\n    let x = lookupIndex[y[mainKey]]; // get corresponding row from lookupTable\n    output.push(select(y, x)); // select only the columns you need\n  }\n  return output;\n\n}","export const capitalize = (s) => {\n  return s && s.split(' ').map(word => word[0].toUpperCase() + word.slice(1)).join(' ');\n}","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport './FiltersComponent.scss'\n\nclass FiltersComponent extends Component {\n    constructor(props) {\n        super(props)\n    }\n    \n    render() {\n        return (\n            <div className=\"FiltersComponent\"></div>\n        );\n    }\n}\n\nFiltersComponent.propTypes = {}\n\nFiltersComponent.defaultProps = {}\n\nexport default FiltersComponent\n","\nimport {scaleQuantile} from 'd3-scale';\nimport _ from 'lodash';\n\nexport const getColorScale = (d) => {\n  console.log(d);\n  return scaleQuantile()\n    .domain(_.range(d[0], d[1], (d[1]-d[0])/10))\n    // .domain([0,5,10,15,20,25,30,35,40])\n    .range(['#f8d5cc','#f4bfb6','#f1a8a5','#ee8f9a','#ec739b','#dd5ca8','#c44cc0','#9f43d7','#6e40e6']);\n}\n\nexport const convertHex = (hex,opacity) => {\n  hex = hex.replace('#','');\n  const r = parseInt(hex.substring(0,2), 16);\n  const g = parseInt(hex.substring(2,4), 16);\n  const b = parseInt(hex.substring(4,6), 16);\n\n  const result = 'rgba('+r+','+g+','+b+','+opacity/100+')';\n  return result;\n}\n\nexport const makeTooltip = (title,items) => {\n  let htmlBlock = \"<div class='tootltip' style='font-size:12px; border: 1px solid #ccc; background-color: rgba(255,255,255,0.9); padding:5px; max-width:150px;'>\"\n  htmlBlock += title ? \"<div style='font-size:20px'>\" + title + \"</div>\" : '';\n  if (items)\n    items.forEach(i => {\n      htmlBlock += (\"<br/><strong>\"+i.label+\":</strong> \")\n      htmlBlock += (\"<br/><div class='tootltip-value' style='font-size:18px;'>\"+i.value+\"</div>\")\n    })\n  htmlBlock += '</div>';\n  return htmlBlock;\n}","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport './DeprivationScatterPlot.scss'\nimport { select } from 'd3-selection'\nimport { scaleBand,scaleLinear,scaleLog } from 'd3-scale'\nimport { axisBottom, axisLeft } from 'd3-axis'\nimport { format } from 'd3-format'\nimport { extent } from 'd3-array'\nimport { getColorScale, convertHex, makeTooltip } from '../../VizHelpers'\nimport _ from 'lodash'\nimport { default as tip } from 'd3-tip'\n\n\nclass DeprivationScatterPlot extends Component {\n    constructor(props){\n      super(props)\n      this.createBarChart = this.createBarChart.bind(this)\n    }\n\n\n    componentDidMount() {\n      this.createBarChart()\n    }\n    \n    componentDidUpdate() {\n      this.createBarChart()\n    }\n    \n    createBarChart() {\n      let data = this.props.data;\n      const filterFunc = this.props.addFilter;\n      select('.d3-tip').remove();\n\n      const opacity = 100;\n\n      let tooltip = tip()\n      .attr('class', 'd3-tip')\n      .offset([0, 20])\n      .direction(d => 'e')\n      .html((d) => {\n        console.log(d);\n        return makeTooltip(\n          d.placeName + \" [\" + d.id + \"]\",\n          [\n            {label:this.props.xValLabel.label, value:format(\".2f\")(d[this.props.xVal])},\n            {label:\"Amount Awarded\", value:\"£\"+format(\",.0f\")(d['Amount Awarded'])}\n          ]\n        )\n      })\n\n\n      console.log(this.props);\n      data = data.map(d => {\n        return {\n          'id': d['id'],\n          [this.props.xVal]: d[this.props.xVal] ? (+d[this.props.xVal]) : 0,\n          'Amount Awarded': d['Amount Awarded'] ? (+d['Amount Awarded']) : 0,\n          'filterLocation': d.filterLocation,\n          'placeName': d.placeName\n        }\n      });\n\n      // console.log(data);\n  \n      var margin = {top: 20, right: 20, bottom: 90, left: 90},\n      width = this.props.dimensions.width - margin.left - margin.right,\n      height = this.props.dimensions.height - margin.top - margin.bottom,\n      node = select(this.node);\n  \n      const xVal = this.props.xVal;\n      const xValues = data.map(d => +d[this.props.xVal]);\n      const yValues = data.map(d => +d['Amount Awarded']);\n\n      let [yMin, yMax] = extent(yValues);\n      yMin = yMin > 0 ? yMin : 10000;\n      yMax = yMax > 0 ? yMax : yMin;\n      \n      // set the ranges\n      var x = scaleLinear()\n                .range([0, width])\n                .domain(extent(xValues))\n                // .padding(0.1);\n      var y = scaleLog()\n                .range([height, 0])\n                .domain([yMin,yMax])\n          \n    const colorScale = getColorScale(extent(xValues));\n\n    node.selectAll(\"g\").remove();\n  \n    const g = node.append('g');\n    g.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    g.selectAll(\".dot\")\n      .data(data.filter(d => +d['Amount Awarded']>=yMin))\n    .enter().append(\"circle\")\n      .attr(\"class\", \"dot\")\n      .attr(\"r\", 3.5)\n      .attr(\"stroke\", '#999')\n      .attr(\"stroke-width\", 1)\n      .attr(\"cx\", d => x(+d[xVal]))\n      .attr(\"cy\", d => {\n        return +d['Amount Awarded'] > yMin ? y(+d['Amount Awarded']) : yMin;\n      })\n      .attr('fill', d => d['filterLocation'] ? convertHex(colorScale(+d[xVal]),opacity) : \"rgba(0,0,0,0)\")\n      .on('mouseover', function(d) {\n        tooltip.show(d,this);\n        select(this)\n          .attr(\"r\", 15)\n          .attr(\"fill\",convertHex(colorScale(+d[xVal]),opacity))\n          .attr(\"stroke\", \"#f48320\")\n          .attr(\"stroke-width\", 3);\n      })\n      .on('mouseout', function(d) {\n        tooltip.hide();\n        select(this)\n          .attr(\"r\", 3.5)\n          .attr(\"fill\",d => d['filterLocation'] ? convertHex(colorScale(+d[xVal]),opacity) : \"rgba(0,0,0,0)\")\n          .attr(\"stroke\", '#999')\n          .attr(\"stroke-width\", 1);\n      })\n      .on('click', function(d) { \n        console.log(this.props);\n        tooltip.hide();\n        filterFunc({'location': [d['id']] },true);\n      });\n\n      // node.selectAll('g').on(\"click\",function(d){ \n      //   console.log(d);\n      //   filterFunc({}); \n      // })\n\n    node.call(tooltip);\n\n\n\n      // add the x Axis\n    g.append(\"g\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(axisBottom(x).ticks(4).tickFormat( format(\".3s\") ));\n\n    // add the y Axis\n    g.append(\"g\")\n    .call(axisLeft(y)\n      .ticks(4)  \n      .tickFormat(function(d) {return \"£\"+format(\".3s\")(d)\n        .replace('M', ' mil')\n        .replace('G', ' bil')\n      }));\n\n    }\n    \n\n    render() {\n        return (\n      <div className=\"DonorBarChart\">\n        <button onClick={this.props.addFilter.bind(this,{'location': 'reset'})}>Clear Scatterplot Filters</button>\n        <svg ref={node => this.node = node}\n          width={this.props.dimensions.width} height={this.props.dimensions.width}>\n        </svg>\n      </div>\n      );\n    }\n}\n\nDeprivationScatterPlot.propTypes = {}\n\nDeprivationScatterPlot.defaultProps = {}\n\nexport default DeprivationScatterPlot\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport styles from './DonorBarChart.scss'\nimport { select } from 'd3-selection'\nimport { scaleBand,scaleLinear } from 'd3-scale'\nimport { axisBottom, axisLeft } from 'd3-axis'\nimport { format } from 'd3-format'\nimport { makeTooltip } from '../../VizHelpers'\nimport _ from 'lodash'\nimport { default as tip } from 'd3-tip'\n\n\nclass DonorBarChart extends Component {\n  constructor(props){\n    super(props)\n    this.createBarChart = this.createBarChart.bind(this)\n  }\n  componentDidMount() {\n    this.createBarChart()\n  }\n  \n  componentDidUpdate() {\n    this.createBarChart()\n  }\n\n  createBarChart() {\n    let data = this.props.data;\n    // select('.d3-tip').remove();\n\n    let tooltip = tip()\n      .attr('class', 'd3-tip')\n      .offset([0, -20])\n      .direction(d => 'w')\n      .html((d) => {\n        return makeTooltip(\n          d.year,\n          [\n            {label:\"Number of projects\", value:d.projects},\n            {label:\"Amount Awarded\", value:\"£\"+format(\",.0f\")(d.amount)}\n          ]\n        )\n      })\n\n    // console.log(data);\n\n    var margin = {top: 10, right: 10, bottom: 40, left: 60},\n    width = 300 - margin.left - margin.right,\n    height = 150 - margin.top - margin.bottom,\n    node = select(this.node);\n\n    const values = data.values.map(d => d.value['total_awarded']);\n    const dataForChart = data.values\n      .map(d => \n        ({\n          year:parseInt(d.key),\n          amount:d.value['total_awarded'],\n          projects:d.value['projects']\n        }) \n      );\n\n    // set the ranges\n    var x = scaleBand()\n              .range([0, width])\n              .domain([2013,2014,2015,2016,2017,2018])\n              .padding(0.1);\n    var y = scaleLinear()\n              .range([height, 0])\n              .domain([0,_.max(values)]);\n\n\n    // console.log(values);\n\n    node.selectAll(\"g\").remove();\n  \n    const g = node.append('g');\n    g.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    g.selectAll(\".bar\")\n      .data(dataForChart)\n    .enter().append(\"rect\")\n      .attr(\"class\", \"bar\")\n      .attr(\"x\", function(d) { \n        return x(d.year); })\n      .attr(\"width\", x.bandwidth())\n      .attr(\"y\", function(d) { return y(d.amount); })\n      .attr(\"fill\", '#6e40e6')\n      // .attr(\"fill\", '#602f8f')\n      .attr(\"height\", function(d) { return height - y(d.amount); })\n      .on('mouseover', function(d) {\n        tooltip.show(d,this);\n        select(this)\n          .attr(\"fill\", \"#f48320\");\n      })\n      .on('mouseout', function(d) {\n        tooltip.hide();\n        select(this)\n          .attr(\"fill\", '#6e40e6');\n      });\n\n    // add the x Axis\n    g.append(\"g\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(axisBottom(x));\n\n    // add the y Axis\n    g.append(\"g\")\n    .call(axisLeft(y)\n      .ticks(4)\n      .tickFormat(function(d) {return \"£\"+format(\".3s\")(d)\n        .replace('M', ' mil')\n        .replace('G', ' bil')\n      }));\n    \n\n    node.call(tooltip);\n  }\n\n  render() {\n    return (\n      <div className=\"DonorBarChart\">\n        <svg className=\"StackedBarChart\" ref={node => this.node = node}\n          width={300} height={150}>\n        </svg>\n      </div>\n    );\n}\n}\n\nDonorBarChart.propTypes = {}\n\nDonorBarChart.defaultProps = {}\n\nexport default DonorBarChart\n\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { getColorScale, convertHex, makeTooltip } from '../../VizHelpers'\n\nimport mapboxgl from 'mapbox-gl'\nimport './MapComponent.scss'\nimport { extent } from 'd3-array'\n\n\nmapboxgl.accessToken = 'pk.eyJ1IjoieWFubmF1bmdvYWsiLCJhIjoiY2prdWVzemFqMGZ6dzNzbnc0Z3N0enBiMiJ9.TFt7qYDiE1k5bBt7NdFCrQ';\n\nclass MapComponent extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      opacity: 90,\n      mainLayerId: 'admin-level-boundaries'\n    }\n  }\n\n  setStateForMe = (state) => this.setState(state);\n\n  // Create a popup, but don't add it to the map yet.\n  markerHeight = 5; \n  markerRadius = 5; \n  linearOffset = 25;\n  popupOffsets = {\n  'top': [0, 0],\n  'top-left': [0,0],\n  'top-right': [0,0],\n  'bottom': [0, -this.markerHeight],\n  'bottom-left': [this.linearOffset, (this.markerHeight - this.markerRadius + this.linearOffset) * -1],\n  'bottom-right': [-this.linearOffset, (this.markerHeight - this.markerRadius + this.linearOffset) * -1],\n  'left': [this.markerRadius, (this.markerHeight - this.markerRadius) * -1],\n  'right': [-this.markerRadius, (this.markerHeight - this.markerRadius) * -1]\n  };\n\n  popup = new mapboxgl.Popup({\n    closeButton: false,\n    offset: this.popupOffsets\n  });\n\n  componentDidMount() {\n    const { opacity,mainLayerId,mainSourceId } = this.state;\n\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      style: 'mapbox://styles/mapbox/streets-v9',\n      center: this.props.mapFormatting.position,\n      zoom: this.props.mapFormatting.zoom\n    });\n\n    let myMap = this.map;\n\n    \n\n    myMap.on('load', () => {\n      const {mapData, scatterPlotData, xVal, mapGeoId, mapGeoPlaceName,allMapSources} = this.props;\n      const expression = this.buildDataLayer(mapData, scatterPlotData, xVal, mapGeoId, mapGeoPlaceName, opacity);\n      \n      allMapSources.forEach(d => this.addSource(d.sourceName,d.filePath));\n      this.addDataLayer(expression,mapData);\n      this.setUpMouseOver(mainLayerId,mapData,mapGeoPlaceName,this.popup);\n      \n      \n\n    });\n\n  }\n\n  setUpMouseOver(mainLayerId,mapData,mapGeoPlaceName,popup) {\n    let hoveredStateId =  null;\n\n    let myMap = this.map;\n\n    // When the user moves their mouse over the state-fill layer, we'll update the\n    // feature state for the feature under the mouse.\n    myMap.on(\"mousemove\", mainLayerId, function(e) {\n      if (e.features.length > 0) {\n        if (hoveredStateId) {\n            myMap.setFeatureState({source: mapData, id: hoveredStateId}, { hover: false});\n          }\n          // hoveredStateId = e.features[0].properties[mapGeoId];\n          hoveredStateId = e.features[0].id;\n          console.log({source: mapData, id: hoveredStateId});\n          myMap.setFeatureState({source: mapData, id: hoveredStateId}, { hover: true});\n\n          // Display a popup with the name of the location\n          console.log(e.lngLat);\n          popup.setLngLat(e.lngLat)\n            .setHTML(makeTooltip(e.features[0].properties[mapGeoPlaceName]))\n            .addTo(myMap);\n\n        }\n      });\n    \n    // When the mouse leaves the state-fill layer, update the feature state of the\n    // previously hovered feature.\n    myMap.on(\"mouseleave\", mainLayerId, function() {\n      if (hoveredStateId) {\n        myMap.setFeatureState({source: mapData, id: hoveredStateId}, { hover: false});\n      }\n      hoveredStateId =  null;\n      popup.remove();\n    });\n  }\n\n  buildDataLayer(mapData, scatterPlotData, xVal, mapGeoId, mapGeoPlaceName, opacity) {\n\n    const xValues = scatterPlotData.map(d => +d[xVal]);\n    const yValues = scatterPlotData.map(d => +d['Amount Awarded']);\n        \n    const colorScale = getColorScale(extent(xValues));\n\n    let expression = [\"match\", [\"get\", mapGeoId]];\n\n    scatterPlotData.forEach(function(row) {\n      const color = row[\"filterLocation\"] \n        ? convertHex(colorScale(+row[xVal]),opacity) \n        : \"rgba(0,0,0,0)\" ;\n      expression.push(row[\"id\"], color);\n    });\n\n    expression.push(\"rgba(0,0,0,0)\");\n    return expression;\n  }\n\n  addSource(sourceName,filePath) {\n    this.map.addSource(sourceName, {\n      type: 'geojson',\n      data: filePath,\n      generateId: true\n    });\n  }\n\n  addDataLayer(expression,sourceName) {\n    this.map.addLayer({\n      id: this.state.mainLayerId,\n      type: 'fill',\n      source: sourceName,\n      \"paint\": {\n        \"fill-color\": expression,\n        \"fill-outline-color\": \"rgba(0,0,0,0.1)\"\n      }\n    }, 'place-city-sm');\n\n    this.map.addLayer({\n      id: (this.state.mainLayerId+'_highlight'),\n      type: 'line',\n      source: sourceName,\n      \"paint\": {\n        \"line-color\": [\"case\",\n          [\"boolean\", [\"feature-state\", \"hover\"], false],\n            \"#f48320\",\n            \"rgba(0,0,0,0.1)\"\n          ],\n          \"line-width\": [\"case\",\n          [\"boolean\", [\"feature-state\", \"hover\"], false],\n            2,\n            0\n          ]\n        }\n      });\n  }\n\n  removeDataLayer() {\n    this.map.removeLayer(this.state.mainLayerId);\n    this.map.removeLayer(this.state.mainLayerId+'_highlight');\n  }\n  \n  \n  componentWillUnmount() {\n    this.map.remove();\n  }\n\n\n  componentWillReceiveProps(nextProps) {\n    console.log(nextProps);\n    console.log(this.map);\n    \n    if (nextProps.mapData !== this.props.mapData ||\n      nextProps.scatterPlotData !== this.props.scatterPlotData ||\n      nextProps.xVal !== this.props.xVal) \n    {\n      const {mapData, scatterPlotData, xVal, mapGeoId, mapGeoPlaceName} = nextProps;\n      const { opacity } = this.state;\n\n      const waiting = () => {\n        if (!this.map.isStyleLoaded() || !this.map.getLayer(this.state.mainLayerId)) {\n          setTimeout(waiting, 200);\n        } else {\n          console.log(this.map.getLayer(this.state.mainLayerId));\n          this.removeDataLayer();\n\n          const expression = this.buildDataLayer(mapData, scatterPlotData, \n            xVal, mapGeoId, mapGeoPlaceName, opacity);\n          this.addDataLayer(expression,mapData);\n          this.setUpMouseOver(this.state.mainLayerId,mapData,mapGeoPlaceName,this.popup);\n        }\n      }\n      waiting();\n    } else console.log('Still loading data');\n  }\n  \n  // setFill() {\n  //   const { property, stops } = this.state.active;\n  //   this.myMap.setPaintProperty('countries', 'fill-color', {\n  //     property,\n  //     stops\n  //   });    \n  // }\n\n  render() {\n    const style  ={\n      position: 'relative',\n      // top: 0,\n      width: '400px',\n      height: '500px'\n    };\n\n\n    // return <div className=\"MapComponent\" style={style} ref={el => this.mapContainer = el} />;\n\n    return <div className=\"MapComponent\" >\n      <div style={style} ref={el => this.mapContainer = el} className=\"absolute top right left bottom MapComponentMap\" />\n    </div>\n  }\n\n    \n}\n\nMapComponent.propTypes = {}\n\nMapComponent.defaultProps = {}\n\nexport default MapComponent\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport styles from './BodyComponent.scss'\nimport { Grid, Row, Col } from 'react-flexbox-grid';\nimport DeprivationScatterPlot from '../DeprivationScatterPlot/DeprivationScatterPlot';\nimport DonorBarChart from '../DonorBarChart/DonorBarChart';\nimport MapComponent from '../MapComponent/MapComponent';\nimport Slider, { createSliderWithTooltip } from 'rc-slider'\n\nimport 'rc-slider/assets/index.css';\n\nconst YearSlider = createSliderWithTooltip(Slider.Range);\n\nclass BodyComponent extends Component {\n  constructor(props) {\n    super(props)\n\n  }\n\n  state = {\n    yearsRange: this.props.yearsRange ? this.props.yearsRange : [2013,2018]\n  }\n\n  // componentWillReceiveProps(nextProps) {\n  //   console.log(nextProps);\n  //   if (nextProps.yearsRange) \n  //   {\n  //     this.setState({\n  //       yearsRange: this.props.yearsRange\n  //     })  \n  //   } else console.log('Still loading data');\n  // }\n    \n\n  render() {\n    console.log(this.props);\n    console.log(this.props.yearsRange);\n\n    return (\n      <div className=\"BodyComponent\">\n        <Grid fluid>\n          <Row className='filtersRow'>\n            <Col xs className='col right-col'> \n              Years filter: \n              {/* {this.props.yearsRange[0] === this.props.yearsRange[1]\n                ? this.props.yearsRange[0]\n                : this.props.yearsRange[0]+ ' to ' +this.props.yearsRange[1]\n              } */}\n              <YearSlider className='yearsSlider'\n                allowCross={true}\n                defaultValue={[this.state.yearsRange[0],this.state.yearsRange[1]+1]}\n                min={2013}\n                max={2019}\n                // tipFormatter={formatter()}\n                onAfterChange={(range) => this.props.addFilter({'years': range })}\n                // onAfterChange={(range) => this.setState({yearsRange: range })}\n                // tipProps={{ placement: 'top', prefixCls: 'rc-tooltip'}}\n                dots={true}\n                pushable={true}\n                width={200}\n                  />\n            </Col>   \n          </Row>\n          <Row>\n            <Col xs className='col left-col'> \n              {/* Hello uptown */}\n              <MapComponent \n                mapFormatting={this.props.mapFormatting}\n                scatterPlotData={this.props.scatterPlotData}\n                mapData={this.props.mapData}\n                allMapSources={this.props.allMapSources}\n                xVal={this.props.scatterPlotXVal}\n                xValLabel={this.props.scatterPlotXValLabel}\n                mapGeoId={this.props.mapGeoId}\n                mapGeoPlaceName={this.props.mapGeoPlaceName}\n              />\n            </Col>\n            <Col xs className='col center-col'> \n              {/* Hello midtown */}\n              <div className='scatterplotView'>\n              <DeprivationScatterPlot\n                data={this.props.scatterPlotData}\n                // xVal='IMD_avg_score'\n                xVal={this.props.scatterPlotXVal}\n                xValLabel={this.props.scatterPlotXValLabel}\n                dimensions={({width:400,height:400})}\n                addFilter={this.props.addFilter.bind(this)}\n              />\n            </div>\n            </Col>\n            <Col xs className='col right-col'> \n              {/* Hello downtown  */}\n              {this.props.smallMultiplesData.map(d => <div>\n                {d.key}<br/>\n                <DonorBarChart\n                  data = {d}\n                />\n              </div>)}\n            </Col>\n          </Row>\n        </Grid>\n      </div>\n    );\n  }\n}\n\nBodyComponent.propTypes = {}\n\nBodyComponent.defaultProps = {}\n\nexport default BodyComponent\n","import React, { Component } from 'react'\nimport mapboxgl from 'mapbox-gl'\nimport PropTypes from 'prop-types'\n// import 'mapbox-gl/dist/mapbox-gl.css';\n// import './TempBodyComponent.scss'\nimport DonorBarChart from '../DonorBarChart/DonorBarChart'\nimport DeprivationScatterPlot from '../DeprivationScatterPlot/DeprivationScatterPlot';\n\nimport data from '../../data/combined_deprivation_ward.json' \nimport donor_data from '../../data/grants_by_lad_ward_region_donor_year.json'\nimport scatter_data from '../../data/grants_by_lad_deprivation.json'\n\n// class TempBodyComponent extends Component {\n//     constructor(props) {\n//         super(props)\n//     }\n    \n//     render() {\n//         return (\n//             <div className=\"TempBodyComponent\"></div>\n//         );\n//     }\n// }\n\n// TempBodyComponent.propTypes = {}\n\n// TempBodyComponent.defaultProps = {}\n\nmapboxgl.accessToken = 'pk.eyJ1IjoieWFubmF1bmdvYWsiLCJhIjoiY2prdWVzemFqMGZ6dzNzbnc0Z3N0enBiMiJ9.TFt7qYDiE1k5bBt7NdFCrQ';\n\nconst options = [{\n  name: 'IMD',\n  description: 'Index of Multiple Deprivation Score',\n  property: 'IMD_avg_score',\n  stops: [\n    [0, '#f8d5cc'],\n    [5, '#f4bfb6'],\n    [10, '#f1a8a5'],\n    [15, '#ee8f9a'],\n    [20, '#ec739b'],\n    [25, '#dd5ca8'],\n    [30, '#c44cc0'],\n    [35, '#9f43d7'],\n    [40, '#6e40e6']\n  ]\n}, {\n  name: 'Health',\n  description: 'Index of Health Deprivation Score',\n  property: 'Health_avg_score',\n  stops: [\n    [-2.5, '#f8d5cc'],\n    [-2, '#f4bfb6'],\n    [-1.5, '#f1a8a5'],\n    [-1, '#ee8f9a'],\n    [-0.5, '#ec739b'],\n    [0, '#dd5ca8'],\n    [0.5, '#c44cc0'],\n    [1, '#9f43d7'],\n    [1.5, '#6e40e6']\n  ]\n}]\n\nclass TempBodyComponent extends React.Component {\n  map;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      active: options[0],\n      dataByDonor: [],\n      scatterData: []\n    };\n  }\n\n  componentDidUpdate() {\n    // this.setFill();\n    const waiting = () => {\n      if (!this.map.isStyleLoaded()) {\n        setTimeout(waiting, 200);\n      } else {\n        this.setFill();\n      }\n    };\n    waiting();\n  }\n\n  componentWillMount() {\n    console.log(scatter_data);\n    // const data = nestDonorData(this.state.dataByDonor);\n    this.setState({\n      dataByDonor: this.props.smallMultiplesData,\n      scatterData: scatter_data\n      // scatterData: this.props.scatterPlotData\n    });\n  }\n\n  componentDidMount() {\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      // container: this.map,\n      style: 'mapbox://styles/mapbox/streets-v9',\n      center: [6, 52.561928],\n      zoom: 5,\n      width: '400px'\n    });\n\n    this.map.on('load', () => {\n      console.log(data);\n      this.map.addSource('countries', {\n        type: 'geojson',\n        data\n      });\n\n      \n\n      this.map.addLayer({\n        id: 'countries',\n        type: 'fill',\n        source: 'countries'})\n      // }, 'LSOA2011_CD'); // ID metches `mapbox/streets-v9`\n      // }, 'country-label-lg'); // ID metches `mapbox/streets-v9`\n\n      this.setFill();\n    });\n\n    // this.map.on('style.load', () => {\n\n    //   // const waiting = () => {\n    //   //   if (!this.map.isStyleLoaded()) {\n    //   //     setTimeout(waiting, 200);\n    //   //   } else {\n    //       this.map.addLayer({\n    //         id: 'countries',\n    //         type: 'fill',\n    //         source: 'countries'})\n    //       // }, 'LSOA2011_CD'); // ID metches `mapbox/streets-v9`\n    //       // }, 'country-label-lg'); // ID metches `mapbox/streets-v9`\n    \n    //       this.setFill();\n    //   //   }\n    //   // };\n    //   // waiting();\n      \n    // });\n\n    console.log(this.map);\n  }\n\n  setFill() {\n    const { property, stops } = this.state.active;\n    this.map.setPaintProperty('countries', 'fill-color', {\n      property,\n      stops\n    });    \n  }\n\n  render() {\n    const { name, description, stops, property } = this.state.active;\n    const renderLegendKeys = (stop, i) => {\n      return (\n        <div key={i} className='txt-s'>\n          <span className='mr6 round-full w12 h12 inline-block align-middle' style={{ backgroundColor: stop[1] }} />\n          <span>{`${stop[0].toLocaleString()}`}</span>\n        </div>\n      );\n    }\n\n    const renderOptions = (option, i) => {\n      return (\n        <label key={i} className=\"toggle-container\">\n          <input onChange={() => this.setState({ active: options[i] })} checked={option.property === property} name=\"toggle\" type=\"radio\" />\n          <div className=\"toggle txt-s py3 toggle--active-white\">{option.name}</div>\n        </label>\n      );\n    }\n\n    return (\n      <div>\n        <div>\n          <div ref={el => this.mapContainer = el} className=\"absolute top right left bottom\" />\n          {/* <div ref={el => this.mapContainer = el} className=\"absolute top right left bottom\" /> */}\n          <div className=\"toggle-group absolute top left ml12 mt12 border border--2 border--white bg-white shadow-darken10 z1\">\n            {options.map(renderOptions)}\n          </div>\n          <div className=\"bg-white absolute bottom left mr12 mb24 py12 px12 shadow-darken10 round z1 wmax180\">\n            <div className='mb6'>\n              <h2 className=\"txt-bold txt-s block\">{name}</h2>\n              <p className='txt-s color-gray'>{description}</p>\n            </div>\n            {stops.map(renderLegendKeys)}\n          </div>\n          <div id='charts' className=\"bg-white absolute top right mr12 mb24 py12 px12 shadow-darken10 round z1 wmax180 chartsBox\">\n            \n            <div className='scatterplotView'>\n              <DeprivationScatterPlot\n                data={this.state.scatterData}\n                // xVal='IMD_avg_score'\n                xVal={this.props.scatterPlotXVal}\n              />\n            </div>\n            <div className='smallmultiplesView'>\n              {this.state.dataByDonor.map(d => <div>\n                {d.key}<br/>\n                <DonorBarChart\n                  data = {d}\n                />\n              </div>)}\n              \n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default TempBodyComponent\n","import React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport { loadAllData } from './DataLoading';\nimport { prepAllData } from './DataHandling';\nimport FiltersComponent from './components/FiltersComponent/FiltersComponent';\nimport BodyComponent from './components/BodyComponent/BodyComponent';\nimport TempBodyComponent from './components/TempBodyComponent/TempBodyComponent';\nimport _ from 'lodash';\n\nimport { Grid, Row, Col } from 'react-flexbox-grid';\nimport Select from 'react-select';\n\n\nclass App extends Component {\n\n  state = {\n\t\tdata: [],\n\t\tmutatedData: {\n\t\t\t// companyPayments: []\n\t\t},\n\t\tlayerControls: [],\n\t\tselectedRegion: 'eng',\n    selectedGeoLevel: 'LAD',\n\t\tselectedComparison: ['deprivation','comparison_IMD_avg_score'],\n\t\tfilters: {}\n  }\n\t\n\taddFilter = (filters,toggle) => {\n\t\tconsole.log(filters)\n\t\tconst filterKeys = Object.keys(filters);\n\t\tlet newFilterObj = this.state.filters;\n\n\t\tfilterKeys.forEach(k => {\n\t\t\tconsole.log(newFilterObj[k]);\n\t\t\tconsole.log(filters[k]);\n\t\t\tif (!toggle || filters[k]==='reset' \n\t\t\t|| !newFilterObj[k] || newFilterObj[k]==='reset') {\n\t\t\t\tnewFilterObj[k] = filters[k];\n\t\t\t} else {\n\t\t\t\tlet consolidatedFilters = [];\n\t\t\t\tconsolidatedFilters = consolidatedFilters\n\t\t\t\t\t.concat(newFilterObj[k].filter(d => !(filters[k]).includes(d)));\n\t\t\t\tconsole.log(consolidatedFilters);\n\t\t\t\tconsolidatedFilters =\tconsolidatedFilters\n\t\t\t\t\t.concat(filters[k].filter(d => !(newFilterObj[k]).includes(d)));\n\t\t\t\tconsole.log(consolidatedFilters);\n\n\t\t\t\tnewFilterObj[k] = consolidatedFilters;\n\t\t\t}\n\t\t})\n\n\t\tthis.setState({\n\t\t\tfilters: newFilterObj,\n\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\tthis.state.selectedRegion,\n\t\t\t\tthis.state.selectedGeoLevel,\n\t\t\t\tthis.state.selectedComparison,\n\t\t\t\tnewFilterObj)\n\t\t});\n\t\t\n\t}\n\n  componentDidMount() { \n\t\tthis.getData();\n\t}  \n\t\n\tgetData() {\n    loadAllData()\n      .then(data => prepAllData(data,\n        this.state.selectedRegion,\n        this.state.selectedGeoLevel,\n\t\t\t\tthis.state.selectedComparison,\n\t\t\t\tthis.state.filters))\n\t\t\t.then(data =>\n\t\t\t\t// set initial data\n\t\t\t\tthis.setState({ data },\n\t\t\t\t\t() => {\n\t\t\t\t\t\t// set mutated data to initial data on load so filters can access data changes\n\t\t\t\t\t\tthis.setState({ mutatedData: this.state.data },\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tconsole.log(`(mutatedData === data) : ${this.state.mutatedData === this.state.data}`)\n\t\t\t\t\t\t\t\tconsole.log(this.state.mutatedData);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)}\n\t\t\t\t))\n\t}\n\n\n  render() {\n    console.log(this.state.data);\n\n\t\tconst handleRegionChange = (selectedOption) => {\n\t\t\tthis.setState({ \n\t\t\t\tselectedRegion: selectedOption.value,\n\t\t\t\tfilters: {},\n\t\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\t\tselectedOption.value,\n\t\t\t\t\tthis.state.selectedGeoLevel,\n\t\t\t\t\tthis.state.selectedComparison,\n\t\t\t\t\t{})\n\t\t\t});\n\t\t\tconsole.log(`Location selected:`, selectedOption);\n\t\t}\n\n\t\tconst handleGeoChange = (selectedOption) => {\n\t\t\tthis.setState({ \n\t\t\t\tselectedGeoLevel: selectedOption.value,\n\t\t\t\tfilters: {},\n\t\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\t\tthis.state.selectedRegion,\n\t\t\t\t\tselectedOption.value,\n\t\t\t\t\tthis.state.selectedComparison,\n\t\t\t\t\t{})\n\t\t\t});\n\t\t\tconsole.log(`Geo level selected:`, selectedOption);\n\t\t}\n\n\t\tconst handleComparisonChange = (selectedOption) => {\n\t\t\tthis.setState({ \n\t\t\t\tselectedComparison: selectedOption.value,\n\t\t\t\tdata: prepAllData(this.state.data,\n\t\t\t\t\tthis.state.selectedRegion,\n\t\t\t\t\tthis.state.selectedGeoLevel,\n\t\t\t\t\tselectedOption.value,\n\t\t\t\t\tthis.state.filters)\n\t\t\t});\n\t\t\tconsole.log(`Comparison var selected:`, selectedOption);\n\t\t}\n\n\t\tconst getComparisonVarLabel = () => {\n\t\t\treturn this.state.data.comparisonVars\n\t\t\t\t.filter(d => d.value[0] == this.state.selectedComparison[0] &&\n\t\t\t\t\td.value[1] == this.state.selectedComparison[1])[0]\n\t\t}\n\n\t\tconst isLoading = !!(_.isEmpty(this.state.data)) ? true : false;\n\n\t\tconst regionPicker = <div className='regionPickerWrapper'>\n\t\t\t<label>\n\t\t\t\tRegion: \n\t\t\t\t{!!isLoading\n          ? 'loading'\n          :\t<Select\n\t\t\t\t\t\t\tvalue={this.state.data.regions[this.state.selectedRegion]}\n\t\t\t\t\t\t\tonChange={handleRegionChange}\n\t\t\t\t\t\t\toptions={Object.values(this.state.data.regions)}\n\t\t\t\t\t\t\tclassName='regionPicker'\n\t\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t</label>\n\t\t</div>\n\n\t\tconst geoPicker = <div className='geoPickerWrapper'>\n\t\t\t<label>\n\t\t\t\tAdministrative Level: \n\t\t\t\t\t{!!isLoading\n\t\t\t\t\t? 'loading'\n\t\t\t\t\t:\t<Select\n\t\t\t\t\t\t\tvalue={this.state.data.geoLevels[this.state.selectedGeoLevel]}\n\t\t\t\t\t\t\tonChange={handleGeoChange}\n\t\t\t\t\t\t\toptions={Object.values(this.state.data.geoLevels)}\n\t\t\t\t\t\t\tclassName='geoPicker'\n\t\t\t\t\t\t/>\n\t\t\t\t}\n\t\t\t</label>\n\t\t</div>\n\n\t\tconst comparisonPicker = <div className='comparisonPickerWrapper'>\n\t\t<label>\n\t\t\tComparison Variable: \n\t\t\t{console.log(this.state.data.comparisonVars)}\n\t\t\t\t{!!isLoading\n\t\t\t\t? 'loading'\n\t\t\t\t:\t<Select\n\t\t\t\t\t\tvalue={getComparisonVarLabel()}\n\t\t\t\t\t\tonChange={handleComparisonChange}\n\t\t\t\t\t\toptions={Object.values(this.state.data.comparisonVars)}\n\t\t\t\t\t\tclassName='comparisonPicker'\n\t\t\t\t\t/>\n\t\t\t}\n\t\t</label>\n\t\t</div>\n\n    return (\n      <div className=\"App\">\n\t\t\t{!!isLoading\n          ? 'loading'\n          : <div>\n\t\t\t\t\t\t<header className=\"App-header\">\n\t\t\t\t\t\t\t<Grid fluid>\n\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t<Col xs className='col left-col'> \n\t\t\t\t\t\t\t\t\t\t{/* Hello uptown */}\n\t\t\t\t\t\t\t\t\t\t{regionPicker}\n\t\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t\t\t<Col xs className='col center-col'> \n\t\t\t\t\t\t\t\t\t\t{/* Hello midtown */}\n\t\t\t\t\t\t\t\t\t\t{geoPicker}\n\t\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t\t\t<Col xs className='col right-col'> \n\t\t\t\t\t\t\t\t\t\t{/* Hello downtown  */}\n\t\t\t\t\t\t\t\t\t\t{comparisonPicker}\n\t\t\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</header>\n\t\t\t\t\t\t{/* <FiltersComponent/> */}\n\t\t\t\t\t\t<BodyComponent\n\t\t\t\t\t\t\tsmallMultiplesData={this.state.data.dataForSmallMultiples}\n\t\t\t\t\t\t\tscatterPlotData={this.state.data.dataForScatter}\n\t\t\t\t\t\t\tmapData={this.state.data.dataForMap}\n\t\t\t\t\t\t\tallMapSources={this.state.data.allMapSources}\n\t\t\t\t\t\t\t// scatterPlotXVal={this.state.selectedComparison[1].slice(11)}\n\t\t\t\t\t\t\tscatterPlotXVal={this.state.selectedComparison[1]}\n\t\t\t\t\t\t\tscatterPlotXValLabel={getComparisonVarLabel()}\n\t\t\t\t\t\t\taddFilter={this.addFilter.bind(this)}\n\t\t\t\t\t\t\tyearsRange={this.state.filters.years}\n\t\t\t\t\t\t\tmapFormatting={this.state.data.regions[this.state.selectedRegion]}\n\t\t\t\t\t\t\tmapGeoId={this.state.data.geo[this.state.selectedRegion][this.state.selectedGeoLevel].id}\n\t\t\t\t\t\t\tmapGeoPlaceName={this.state.data.geo[this.state.selectedRegion][this.state.selectedGeoLevel].placeName}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/* <TempBodyComponent\n\t\t\t\t\t\t\tsmallMultiplesData={this.state.data.dataForSmallMultiples}\n\t\t\t\t\t\t\tscatterPlotData={this.state.data.dataForScatter}\n\t\t\t\t\t\t\tscatterPlotXVal={this.state.selectedComparison[1].slice(11)}\n\t\t\t\t\t\t/> */}\n\t\t\t\t\t</div>\n\t\t\t}\n      </div>\n    );\n  }\n}\n\nexport default App;\n","// import * as d3 from 'd3';\nimport { csv, json } from 'd3-fetch';\n\n// import geo_eng_LAD from './data/geo/geo_eng_LAD.json';\n// import geo_eng_ward from './data/geo/geo_eng_ward.json';\n\n// import grants_eng_LAD_ward_donor_year from './data/grants/grants_eng_LAD_ward_donor_year.csv';\n\n// import comparison_eng_LAD_deprivation from './data/comparison/comparison_eng_LAD_deprivation.csv';\n// import comparison_eng_ward_deprivation from './data/comparison/comparison_eng_ward_deprivation.csv';\n// import comparison_eng_LAD_charities from './data/comparison/comparison_eng_LAD_charities.csv';\n// import comparison_eng_ward_charities from './data/comparison/comparison_eng_ward_charities.csv';\n// import comparison_eng_LAD_population from './data/comparison/comparison_eng_LAD_population.csv';\n// import comparison_eng_ward_population from './data/comparison/comparison_eng_ward_population.csv';\n\n\nimport _ from 'lodash';\n\n// import geo_eng_LAD from './data/geo/geo_eng_LAD.json';\n// import geo_eng_ward from './data/geo/geo_eng_ward.json';\n\n// import grants_eng_LAD_ward_donor_year from './data/grants/grants_eng_LAD_ward_donor_year.csv';\n\n// import comparison_eng_LAD_deprivation from './data/comparison/comparison_eng_LAD_deprivation.csv';\n// import comparison_eng_ward_deprivation from './data/comparison/comparison_eng_ward_deprivation.csv';\n// import comparison_eng_LAD_charities from './data/comparison/comparison_eng_LAD_charities.csv';\n// import comparison_eng_ward_charities from './data/comparison/comparison_eng_ward_charities.csv';\n// import comparison_eng_LAD_population from './data/comparison/comparison_eng_LAD_population.csv';\n// import comparison_eng_ward_population from './data/comparison/comparison_eng_ward_population.csv';\n\n\n\nexport const loadAllData = () => {\n\n\n  const files = [\n    { name: 'geo_eng_LAD', id: 'LAD2011_CD', placeName: 'lad11nm', data: 'geo_eng_LAD', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/scaffold/app/src/data/geo/geo_eng_LAD.json'},\n    { name: 'geo_eng_ward', id: 'wd17cd', placeName: 'wd17nm', data: 'geo_eng_ward', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/scaffold/app/src/data/geo/geo_eng_ward.json'},\n    {  \n      name: 'grants_eng_LAD_ward_donor_year', \n      data: 'grants_eng_LAD_ward_donor_year',\n      id: {\n        'LAD': 'Recipient District Geographic Code',\n        'ward': 'Recipient Ward Geographic Code'\n      },\n      dataField: 'Amount Awarded', \n      filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/master/app/src/data/grants/grants_eng_LAD_ward_donor_year.csv'\n    },\n    { name: 'comparison_eng_LAD_deprivation', id: 'LAD2013_CD', data: 'comparison_eng_LAD_deprivation', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/master/app/src/data/comparison/comparison_eng_LAD_deprivation.csv'},\n    { name: 'comparison_eng_ward_deprivation', id: 'WD17CD', data: 'comparison_eng_ward_deprivation', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/master/app/src/data/comparison/comparison_eng_ward_deprivation.csv'},\n    { name: 'comparison_eng_LAD_charities', id: 'lad11cd', data: 'comparison_eng_LAD_charities', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/master/app/src/data/comparison/comparison_eng_LAD_charities.csv'},\n    { name: 'comparison_eng_ward_charities', id: 'wd11cd', data: 'comparison_eng_ward_charities', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/master/app/src/data/comparison/comparison_eng_ward_charities.csv'},\n    { name: 'comparison_eng_LAD_population', id: 'lad11cd', data: 'comparison_eng_LAD_population', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/master/app/src/data/comparison/comparison_eng_LAD_population.csv'},\n    { name: 'comparison_eng_ward_population', id: 'Ward Code 1', data: 'comparison_eng_ward_population', filePath: 'https://raw.githubusercontent.com/yanoak/360giving-deprivation/master/app/src/data/comparison/comparison_eng_ward_population.csv'},\n  ]\n\n  const abbreviations = {\n    geoLevel: {\n      'LAD': 'Local Authority District',\n      'ward': 'Ward'\n    },\n    region: {\n      'eng': 'England',\n      'sco': 'Scotland',\n      'nir': 'Northern Ireland',\n      'wal': 'Wales',\n      'uk': 'United Kingdom'\n    }\n  }\n\n  const regions = {\n    eng: { value: 'eng', label: 'England', position: [-1.464854, 52.561928], zoom: 5 }\n  }\n\n  const geoLevels = {\n    LAD: { value: 'LAD', label: 'Local Authority District'},\n    ward: { value: 'ward', label: 'Ward'}\n  }\n\n\n  const promises = [];\n\n  files.forEach((f) => {\n    // if (typeof(f.data) !== 'string') {\n    //   promises.push( f.data );\n    // }  else \n    // if (f.data.slice(0,4) === 'geo_') {\n    //   promises.push( f.filePath );\n    // } else \n    if (f.filePath.slice(-4) === '.csv') {\n      promises.push( csv(f.filePath) );\n    } else if (f.filePath.slice(-5) === '.json') {\n      promises.push( json(f.filePath) );\n    }\n  });\n\n\n  return Promise.all(promises).then(function(values) {\n\n    const result = {\n      geo: {eng: {LAD: {}, ward: {}}}, \n      comparison: {eng: {LAD: {}, ward: {}}},\n      grant: {eng: {}}, \n      abbreviations: abbreviations,\n      regions: regions,\n      geoLevels: geoLevels,\n      allMapSources: []\n    };\n\n    console.log(values);\n\n    for (let i = 0; i < files.length; i++) {\n       const [category, country, geoLevel, ...otherParts] = files[i].name.split('_');\n       const datasetName = category === 'grants' \n        ? [geoLevel, ...otherParts].join('_')\n        : otherParts.join('_');\n\n       switch (category) {\n         case 'geo': { \n           result.geo[country][geoLevel] = {\n             'sourceName': files[i].name,\n             'id': files[i].id, \n             'placeName': files[i].placeName,\n             'data': values[i],\n             'filePath': files[i].filePath,\n             'lookUp': _.keyBy(\n                values[i].features\n                  .map(f => ({'key': f.properties[files[i].id],'value': f.properties[files[i].placeName]}) ), \n               'key'\n               )\n            };\n           break; \n          }\n        case 'grants': { \n          result.grant[country][datasetName] = {\n            'id': files[i].id, \n            'data': values[i],\n            'dataField': files[i].dataField\n          };\n          break; \n         }\n        case 'comparison': { \n          result.comparison[country][geoLevel][datasetName] = {\n            'id': files[i].id, \n            'data': values[i]\n          };\n          break; \n         }\n         default: break;\n       }\n    }\n    _.forEach(result.geo, function(valueRegion, keyRegion) {\n      _.forEach(valueRegion, function(valueLevel, keyLevel) {\n        result.allMapSources.push(valueLevel)\n      })\n    });\n\n    return result;\n  });\n\n}","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}